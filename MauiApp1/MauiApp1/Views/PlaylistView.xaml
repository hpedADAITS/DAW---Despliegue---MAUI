<?xml version="1.0" encoding="utf-8" ?>
<StackLayout xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:resx="clr-namespace:MauiApp1.Resources.Strings"
             x:Class="MauiApp1.Views.PlaylistView"
             Spacing="16"
             Padding="0">

    
    <Border StrokeShape="RoundRectangle 20"
            StrokeThickness="1"
            Stroke="{DynamicResource BorderColor}"
            BackgroundColor="{DynamicResource Surface}"
            Padding="16">
        <VerticalStackLayout Spacing="12">
            <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                <Border StrokeShape="RoundRectangle 12"
                        StrokeThickness="0"
                        BackgroundColor="#E8DEF8"
                        Padding="10,8"
                        WidthRequest="40"
                        HeightRequest="40"
                        HorizontalOptions="Start">
                    <Label Text="â‡…"
                           FontSize="18"
                           FontAttributes="Bold"
                           HorizontalTextAlignment="Center"
                           VerticalTextAlignment="Center"
                           TextColor="#6750A4" />
                </Border>
                <VerticalStackLayout Spacing="2">
                    <Label Text="{x:Static resx:AppResources.SortPlaylistTitle}"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{DynamicResource PrimaryText}" />
                    <Label Text="{x:Static resx:AppResources.SortPlaylistSubtitle}"
                           FontSize="12"
                           TextColor="{DynamicResource SecondaryText}" />
                </VerticalStackLayout>
            </HorizontalStackLayout>

            <Border StrokeShape="RoundRectangle 14"
                    StrokeThickness="1"
                    Stroke="{DynamicResource BorderColor}"
                    BackgroundColor="{DynamicResource SurfaceVariant}"
                    Padding="12,6">
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10" VerticalOptions="Center">
                    <Label Text="{x:Static resx:AppResources.SortOrderLabel}"
                           FontSize="12"
                           FontAttributes="Bold"
                           TextColor="{DynamicResource TertiaryText}"
                           VerticalTextAlignment="Center" />
                    <Picker x:Name="SortPicker"
                            Grid.Column="1"
                            HeightRequest="44"
                            Title="{x:Static resx:AppResources.SortPlaylistTitle}"
                            TextColor="{DynamicResource PrimaryText}"
                            BackgroundColor="Transparent" />
                </Grid>
            </Border>
        </VerticalStackLayout>
    </Border>

    
    <Border StrokeShape="RoundRectangle 20"
            StrokeThickness="0"
            BackgroundColor="{DynamicResource Surface}"
            Padding="8">
        <Grid RowDefinitions="Auto,*" RowSpacing="8">
            <Label Grid.Row="0"
                   Text="{x:Static resx:AppResources.PlaylistHeader}"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="{DynamicResource PrimaryText}"
                   Margin="8,0" />
            <CollectionView x:Name="PlaylistCollectionView"
                            Grid.Row="1"
                            SelectionMode="Single"
                            SelectionChanged="OnPlaylistItemSelected"
                            HeightRequest="400">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border StrokeShape="RoundRectangle 12"
                                StrokeThickness="1"
                                Stroke="{DynamicResource BorderColor}"
                                BackgroundColor="{DynamicResource CardBackground}"
                                Padding="12"
                                Margin="0,4">
                            <Grid ColumnDefinitions="60,*,Auto" ColumnSpacing="12">
                                
                                <Image Grid.Column="0"
                                       Source="{Binding CoverUrl}"
                                       Aspect="AspectFill"
                                       WidthRequest="60"
                                       HeightRequest="60"
                                       BackgroundColor="{DynamicResource SurfaceVariant}" />

                                
                                <VerticalStackLayout Grid.Column="1" Spacing="4">
                                    <Label Text="{Binding Title}"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource PrimaryText}"
                                           LineBreakMode="TailTruncation" />
                                    <Label Text="{Binding Artist}"
                                           FontSize="12"
                                           TextColor="{DynamicResource SecondaryText}"
                                           LineBreakMode="TailTruncation" />
                                    <HorizontalStackLayout Spacing="8">
                                        <Border StrokeShape="RoundRectangle 4" 
                                                StrokeThickness="0" 
                                                BackgroundColor="{DynamicResource SurfaceVariant}"
                                                Padding="6,2">
                                            <Label Text="{Binding Genre}"
                                                   FontSize="10"
                                                   TextColor="{DynamicResource TertiaryText}" />
                                        </Border>
                                        <Border StrokeShape="RoundRectangle 4" 
                                                StrokeThickness="0" 
                                                BackgroundColor="{DynamicResource SurfaceVariant}"
                                                Padding="6,2">
                                            <Label Text="{Binding Bitrate, StringFormat='{0} kbps'}"
                                                   FontSize="10"
                                                   TextColor="{DynamicResource TertiaryText}" />
                                        </Border>
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>

                                
                                <Label Grid.Column="2"
                                       Text="{Binding Duration}"
                                       FontSize="12"
                                       TextColor="{DynamicResource TertiaryText}"
                                       VerticalOptions="Center" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </Border>

    
    <Button x:Name="MissingCoverToggle"
            Text="{x:Static resx:AppResources.MissingCoverTitle}"
            Style="{StaticResource PrimaryCallToActionStyle}"
            Clicked="OnMissingCoverToggleClicked" />

    
    <Border x:Name="MissingCoverView"
            IsVisible="False"
            StrokeShape="RoundRectangle 20"
            StrokeThickness="0"
            BackgroundColor="{DynamicResource Surface}"
            Padding="8">
        <Grid RowDefinitions="Auto,*" RowSpacing="8">
            <Label Grid.Row="0"
                   Text="{x:Static resx:AppResources.MissingCoverTitle}"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="{DynamicResource PrimaryText}"
                   Margin="8,0" />
            <CollectionView x:Name="MissingCoverCollectionView"
                            Grid.Row="1"
                            HeightRequest="300">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border StrokeShape="RoundRectangle 12"
                                StrokeThickness="1"
                                Stroke="{DynamicResource BorderColor}"
                                BackgroundColor="{DynamicResource CardBackground}"
                                Padding="12"
                                Margin="0,4">
                            <VerticalStackLayout Spacing="4">
                                <Label Text="{Binding Title}"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="{DynamicResource PrimaryText}"
                                       LineBreakMode="TailTruncation" />
                                <Label Text="{Binding Artist}"
                                       FontSize="12"
                                       TextColor="{DynamicResource SecondaryText}"
                                       LineBreakMode="TailTruncation" />
                                <HorizontalStackLayout Spacing="8">
                                    <Border StrokeShape="RoundRectangle 4" 
                                            StrokeThickness="0" 
                                            BackgroundColor="{DynamicResource SurfaceVariant}"
                                            Padding="6,2">
                                        <Label Text="{Binding Genre}"
                                               FontSize="10"
                                               TextColor="{DynamicResource TertiaryText}" />
                                    </Border>
                                    <Border StrokeShape="RoundRectangle 4" 
                                            StrokeThickness="0" 
                                            BackgroundColor="{DynamicResource SurfaceVariant}"
                                            Padding="6,2">
                                        <Label Text="{Binding Bitrate, StringFormat='{0} kbps'}"
                                               FontSize="10"
                                               TextColor="{DynamicResource TertiaryText}" />
                                    </Border>
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </Border>

</StackLayout>
